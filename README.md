# Argo

## Prerequisite:
  - Minikube & Argo on your local machine
    ```
    $ brew cask install minikube
    $ brew install hyperkit
    $ minikube config set vm-driver hyperkit
    $ brew tap argoproj/tap
    $ brew install argoproj/tap/argocd
    ```

## Settup
- [Getting started](https://argoproj.github.io/argo-cd/getting_started/)

1. Setup your cluster
  ```
  $ minikube start --kubernetes-version v1.15.7
  $ eval $(minikube docker-env)
  $ kubectl config get-contexts
  ```

2. Build local docker image with the k8s docker engine
  - You want to make sure you build the docker image inside the cluster so it will have access to it
    ```
    $ cd ./docker
    $ ./build.sh
    $ docker images
    ```

3. Test your k8s application locally
    ```
    $ cd ./k8s
    $ kubectl create namespace testing-k8s
    $ ./build.sh
    $ minikube service test-node-express-api  --namespace=testing-k8s
    ```

4. Install Argo CD
    ```
    $ kubectl create namespace argocd
    $ kubectl apply -n argocd -f argo/install.yaml
    ```
  - this will create 2 new resources "CustomResourceDefinition" project & application
    ```
    $ kubectl create clusterrolebinding YOURNAME-cluster-admin-binding --clusterrole=cluster-admin --user=YOUREMAIL@gmail.com
    ```

5. Run the Argo CD server locally
  - By default, the Argo CD API server is not exposed with an external IP. 
  - To access the API server, choose one of the following techniques to expose the Argo CD API server:
    (1) ***Port Forwarding***
      - Kubectl port-forwarding can also be used to connect to the API server without exposing the service.
        ```
        $ kubectl port-forward svc/argocd-server -n argocd 8080:443
        ```
      - The API server can then be accessed using the localhost:8080

6. Login Using The CLI
  - The initial password is autogenerated to be the pod name of the Argo CD API server. Get the password with the command:
    $ kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2
    argocd-server-xxxxxxxxx-xxxxx
  - got to https://localhost:8080/
    username: admin
    password: argocd-server-xxxxxxxxx-xxxxx






7. Create an Application
```
$ cd ..
$ kubectl apply -n argocd -f app.yaml
```




